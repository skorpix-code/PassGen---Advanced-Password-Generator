<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PassGen Full Web App with Responsive & Animated Network Background</title>
    <style>
        /* Reset and base */
        * {
            box-sizing: border-box;
        }

        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0d0d0d;
            color: #e0e0e0;
            overflow-x: hidden;
            position: relative;
        }

        /* Canvas background full screen */
        canvas#network-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
            z-index: 0;
            background: #0d0d0d;
        }

        /* Main container */
        .container {
            position: relative;
            z-index: 1;
            background: none;
            backdrop-filter: blur(1px);
            border-radius: 20px;
            margin: 8% auto 40px;
            padding: 25px;
            width: 100%;
            max-width: 520px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(10px);
            animation: fadeIn 0.8s ease;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 2rem;
            letter-spacing: 1px;
            color: #eee;
            animation: slideDown 0.7s ease;
            user-select: none;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-buttons button {
            flex: 1;
            background: #2a2a2a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 12px;
            color: #ddd;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.25s ease-in-out;
            min-width: 80px;
        }

        .nav-buttons button:hover {
            background: #333;
            transform: translateY(-2px);
        }

        .nav-buttons button.active {
            background: #444;
            color: #fff;
            border: 1px solid #555;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2) inset;
            transform: scale(1.02);
        }

        section {
            display: none;
            opacity: 0;
            transform: translateY(15px);
            transition: all 0.35s ease-in-out;
        }

        section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        label {
            display: block;
            margin: 12px 0 6px 0;
            font-weight: 600;
            font-size: 0.9rem;
            user-select: none;
        }

        input[type="text"],
        input[type="number"],
        input[type="password"] {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #333;
            background: #222;
            color: #eee;
            font-size: 1rem;
            box-sizing: border-box;
            transition: background 0.3s ease, border 0.3s ease;
            user-select: text;
        }

        input:focus {
            background: #252525;
            border: 1px solid #666;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
            outline: none;
        }

        input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
        }

        .btn {
            margin-top: 20px;
            width: 100%;
            background: #2d2d2d;
            border: 1px solid #444;
            border-radius: 12px;
            padding: 14px;
            color: #eaeaea;
            font-weight: 600;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .btn:hover {
            background: #3a3a3a;
            border: 1px solid #555;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }

        .btn.retrieve {
            background: #3a3a3a;
            border: 1px solid #555;
        }

        .output {
            margin-top: 20px;
            background: #222;
            border-radius: 12px;
            padding: 12px;
            white-space: pre-wrap;
            font-family: 'Consolas', monospace;
            font-size: 0.95rem;
            min-height: 55px;
            color: #eee;
            border: 1px solid #333;
            animation: fadeIn 0.6s ease;
            user-select: text;
        }

        label.checkbox-inline {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 0.9rem;
            cursor: pointer;
            user-select: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 480px) {
            .container {
                width: 95%;
                padding: 20px;
                border-radius: 15px;
                border: none;
                margin-top: 10%;
                backdrop-filter: blur(0px);
                background: none;
            }

            .nav-buttons {
                flex-direction: column;
            }

            .nav-buttons button {
                margin: 5px 0;
                font-size: 0.95rem;
                padding: 10px;
                min-width: unset;
            }

            h1 {
                font-size: 1.6rem;
            }

            input,
            .btn {
                font-size: 1rem;
                padding: 12px;
            }
        }

        /* Loader styles */
        #loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0d0d0d;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 9999;
            overflow: hidden;
        }

        #loader-text {
            font-size: 2rem;
            color: #eee;
            font-weight: bold;
            letter-spacing: 2px;
            margin-bottom: 40px;
            user-select: none;
        }

        #loader-line {
            width: 8px;
            height: 8px;
            background: #eee;
            border-radius: 50%;
            transition: all 0.8s ease;
        }

        /* Expand dot into horizontal line */
        #loader-line.expand {
            border-radius: 0;
            width: 100%;
            height: 3px;
        }

        /* Split animation */
        #loader.split-top {
            animation: moveUp 1s forwards ease-in-out;
        }

        #loader.split-bottom {
            animation: moveDown 1s forwards ease-in-out;
        }

        @keyframes moveUp {
            to {
                transform: translateY(-100%);
            }
        }

        @keyframes moveDown {
            to {
                transform: translateY(100%);
            }
        }
    </style>
</head>

<body>

    <!-- LOADER -->
    <div id="loader">
        <div id="loader-text">PassGen</div>
        <div id="loader-line"></div>
    </div>

    <canvas id="network-canvas"></canvas>

    <div class="container" role="main" aria-label="Password Generator and Manager Application">
        <h1>üîê PassGen</h1>
        <div class="nav-buttons" role="tablist" aria-label="Application navigation tabs">
            <button id="tab-gen" class="active" onclick="showSection('gen')" role="tab" aria-selected="true"
                aria-controls="section-gen" tabindex="0">Generate</button>
            <button id="tab-check" onclick="showSection('check')" role="tab" aria-selected="false"
                aria-controls="section-check" tabindex="-1">Check</button>
            <button id="tab-history" onclick="showSection('history'); displayHistory();" role="tab"
                aria-selected="false" aria-controls="section-history" tabindex="-1">History</button>
            <button id="tab-manager" onclick="showSection('manager')" role="tab" aria-selected="false"
                aria-controls="section-manager" tabindex="-1">Manager</button>
        </div>

        <section id="section-gen" class="active" role="tabpanel" aria-labelledby="tab-gen" tabindex="0">
            <label for="gen-length">Password Length (6‚Äì30):</label>
            <input type="number" id="gen-length" value="12" min="6" max="30" aria-required="true" />

            <label class="checkbox-inline"><input type="checkbox" id="gen-uppercase" checked /> Uppercase</label>
            <label class="checkbox-inline"><input type="checkbox" id="gen-lowercase" checked /> Lowercase</label>
            <label class="checkbox-inline"><input type="checkbox" id="gen-numbers" checked /> Numbers</label>
            <label class="checkbox-inline"><input type="checkbox" id="gen-specsym" checked /> Special Symbols</label>

            <button class="btn" onclick="handleGeneratePassword()">Generate Password</button>
            <div id="gen-output" class="output" aria-live="polite" aria-atomic="true"></div>
        </section>

        <section id="section-check" role="tabpanel" aria-labelledby="tab-check" tabindex="0">
            <label for="check-input">Enter password to evaluate:</label>
            <input type="text" id="check-input" aria-required="true" />
            <button class="btn" onclick="handleCheckStrength()">Check Strength</button>
            <div id="check-output" class="output" aria-live="polite" aria-atomic="true"></div>
        </section>

        <section id="section-history" role="tabpanel" aria-labelledby="tab-history" tabindex="0">
            <h3>Last 5 Passwords</h3>
            <div id="history-output" class="output"></div>
        </section>

        <section id="section-manager" role="tabpanel" aria-labelledby="tab-manager" tabindex="0">
            <label for="manager-website">Website:</label>
            <input type="text" id="manager-website" />
            <label for="manager-username">Username:</label>
            <input type="text" id="manager-username" />
            <label for="manager-password">Password:</label>
            <input type="password" id="manager-password" />
            <button class="btn" onclick="handleAddCredential()">Add Credential</button>
            <button class="btn retrieve" style="margin-top:8px;" onclick="handleRetrieveCredential()">Retrieve</button>
            <div id="manager-output" class="output" aria-live="polite" aria-atomic="true"></div>
        </section>
    </div>

    <script>
        /* Loader script */
        let dots = 0;
        const loaderText = document.getElementById("loader-text");
        const loaderLine = document.getElementById("loader-line");
        const loader = document.getElementById("loader");

        // Animate dots "Loading."
        const dotInterval = setInterval(() => {
            dots = (dots + 1) % 4;
            loaderText.textContent = "PassGen" + ".".repeat(dots);
        }, 500);

        // Sequence timing
        setTimeout(() => {
            loaderLine.classList.add("expand"); // expand dot into line
        }, 2000);

        setTimeout(() => {
            clearInterval(dotInterval);

            // Create top and bottom overlays for split animation
            const topOverlay = document.createElement("div");
            const bottomOverlay = document.createElement("div");

            Object.assign(topOverlay.style, {
                position: "fixed",
                top: "0", left: "0", width: "100%", height: "50%",
                background: "#0d0d0d", zIndex: "9998", display: "flex", alignItems: "center",
                justifyContent: "center", flexDirection: "column", color: "#eee",
                fontSize: "2rem", fontWeight: "bold", letterSpacing: "2px"
            });
            Object.assign(bottomOverlay.style, {
                position: "fixed",
                bottom: "0", left: "0", width: "100%", height: "50%",
                background: "#0d0d0d", zIndex: "9998"
            });

            topOverlay.textContent = "PassGen";
            document.body.appendChild(topOverlay);
            document.body.appendChild(bottomOverlay);

            // Animate split parts away
            setTimeout(() => {
                topOverlay.style.transition = "transform 1s ease-in-out";
                bottomOverlay.style.transition = "transform 1s ease-in-out";
                loader.style.transition = "opacity 1s ease, transform 1s ease";
                loader.style.opacity = "0";
                loader.style.transform = "scale(0.95)";
                topOverlay.style.transform = "translateY(-100%)";
                bottomOverlay.style.transform = "translateY(100%)";

                // Fade in canvas and container
                const canvas = document.getElementById("network-canvas");
                const container = document.querySelector(".container");

                canvas.style.transition = "opacity 1s ease, transform 1s ease";
                container.style.transition = "opacity 1s ease, transform 1s ease";
                canvas.style.opacity = "1";
                canvas.style.transform = "translateY(0)";
                container.style.opacity = "1";
                container.style.transform = "translateY(0)";
            }, 300);

            // Initially hide canvas and container for fade-in
            const canvas = document.getElementById("network-canvas");
            const container = document.querySelector(".container");
            canvas.style.opacity = "0";
            canvas.style.transform = "translateY(30px)";
            container.style.opacity = "0";
            container.style.transform = "translateY(30px)";

            // Remove loaders after animation finishes
            setTimeout(() => {
                loader.remove();
                topOverlay.remove();
                bottomOverlay.remove();
            }, 1500);

        }, 3500);


    </script>


    <script>
        const canvas = document.getElementById("network-canvas");
        const ctx = canvas.getContext("2d");

        let width, height;
        let nodes = [];
        // const maxNodeCount = 200; // Number of points/nodes
        // const maxDistance = 150; // Max distance to connect nodes
        // const mouseInfluenceRadius = 150; // Radius around pointer for interaction

        const isMobile = /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent) || window.innerWidth < 768;

        const maxNodeCount = isMobile ? 80 : 200;   // fewer nodes on mobile devices
        const maxDistance = isMobile ? 90 : 150;    // smaller connection radius on mobile
        const mouseInfluenceRadius = isMobile ? 100 : 150;  // smaller mouse influence radius on mobile

        let mouse = { x: null, y: null, radius: mouseInfluenceRadius };

        function resize() {
            width = window.innerWidth;
            height = window.innerHeight;
            canvas.width = width;
            canvas.height = height;
        }

        window.addEventListener('resize', resize);
        resize();

        class Node {
            constructor(x, y, vx, vy, radius = 2) {
                this.baseX = x;
                this.baseY = y;
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.radius = radius;

                this.idlePhaseX = Math.random() * 2 * Math.PI;
                this.idlePhaseY = Math.random() * 2 * Math.PI;
            }

            move(time) {
                // Add tiny idle oscillation to base position
                const idleAmplitude = 2; // max 2 px around base
                this.baseX += Math.sin(time + this.idlePhaseX) * 0.2;
                this.baseY += Math.cos(time + this.idlePhaseY) * 0.2;

                this.x += this.vx;
                this.y += this.vy;

                if (this.x <= 0 || this.x >= width) this.vx = -this.vx;
                if (this.y <= 0 || this.y >= height) this.vy = -this.vy;

                if (mouse.x !== null && mouse.y !== null) {
                    let dx = this.x - mouse.x;
                    let dy = this.y - mouse.y;
                    let dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < mouse.radius) {
                        let force = (mouse.radius - dist) / mouse.radius * 3.5;
                        this.x += dx / dist * force;
                        this.y += dy / dist * force;
                    } else {
                        this.x += (this.baseX - this.x) * 0.02;
                        this.y += (this.baseY - this.y) * 0.02;
                    }
                } else {
                    this.x += (this.baseX - this.x) * 0.02;
                    this.y += (this.baseY - this.y) * 0.02;
                }
            }

            draw() {
                ctx.beginPath();
                ctx.fillStyle = "#bbb";
                ctx.shadowColor = "rgba(255,255,255,0.15)";
                ctx.shadowBlur = 2;
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initNodes() {
            nodes = [];
            for (let i = 0; i < maxNodeCount; i++) {
                let x = Math.random() * width;
                let y = Math.random() * height;
                let vx = (Math.random() - 0.5) * 1.0;
                let vy = (Math.random() - 0.5) * 1.0;
                nodes.push(new Node(x, y, vx, vy));
            }
        }

        initNodes();

        function drawLines() {
            for (let i = 0; i < nodes.length; i++) {
                for (let j = i + 1; j < nodes.length; j++) {
                    let dx = nodes[i].x - nodes[j].x;
                    let dy = nodes[i].y - nodes[j].y;
                    let dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < maxDistance) {
                        let alpha = 1 - dist / maxDistance;
                        ctx.strokeStyle = `rgba(200, 200, 200, ${alpha * 0.22})`;
                        ctx.lineWidth = 1;
                        ctx.beginPath();
                        ctx.moveTo(nodes[i].x, nodes[i].y);
                        ctx.lineTo(nodes[j].x, nodes[j].y);
                        ctx.stroke();
                    }
                }
            }
        }

        let animationStart = performance.now();

        function animate(now) {
            let time = (now - animationStart) / 1000;
            ctx.clearRect(0, 0, width, height);
            drawLines();
            nodes.forEach(node => {
                node.move(time);
                node.draw();
            });
            requestAnimationFrame(animate);
        }

        requestAnimationFrame(animate);

        window.addEventListener("mousemove", function (e) {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
        });

        window.addEventListener("mouseout", function () {
            mouse.x = null;
            mouse.y = null;
        });

        // ------- Original PassGen UI JS Functions (unchanged) -------

        let passwordHistory = [];

        const STORAGE_MANAGER_KEY = "passManagerData";
        const STORAGE_KEY_KEY = "passSecretKey";

        let passManagerPasswords = {};
        let secretKey = null;

        function showSection(name) {
            const sections = ["gen", "check", "history", "manager"];
            sections.forEach(sec => {
                const elSec = document.getElementById(`section-${sec}`);
                const btn = document.getElementById(`tab-${sec}`);
                if (sec === name) {
                    elSec.classList.add("active");
                    btn.classList.add("active");
                    btn.setAttribute("aria-selected", "true");
                    btn.tabIndex = 0;
                    elSec.tabIndex = 0;
                    elSec.focus();
                } else {
                    elSec.classList.remove("active");
                    btn.classList.remove("active");
                    btn.setAttribute("aria-selected", "false");
                    btn.tabIndex = -1;
                }
            });
        }

        async function loadSecretKey() {
            const keyStr = localStorage.getItem(STORAGE_KEY_KEY);
            if (!keyStr) return null;
            try {
                return window.crypto.subtle.importKey(
                    "jwk",
                    JSON.parse(atob(keyStr)),
                    { name: "AES-GCM" },
                    true,
                    ["encrypt", "decrypt"]
                );
            } catch {
                return null;
            }
        }

        async function saveSecretKey(key) {
            const jwk = await window.crypto.subtle.exportKey("jwk", key);
            localStorage.setItem(STORAGE_KEY_KEY, btoa(JSON.stringify(jwk)));
        }

        async function ensureSecretKey() {
            secretKey = await loadSecretKey();
            if (!secretKey) {
                secretKey = await window.crypto.subtle.generateKey(
                    { name: "AES-GCM", length: 256 },
                    true,
                    ["encrypt", "decrypt"]
                );
                await saveSecretKey(secretKey);
            }
        }

        async function encryptText(plainText) {
            if (!secretKey) await ensureSecretKey();
            const iv = window.crypto.getRandomValues(new Uint8Array(12));
            const enc = new TextEncoder().encode(plainText);
            const cipherBuffer = await window.crypto.subtle.encrypt(
                { name: "AES-GCM", iv },
                secretKey,
                enc
            );
            const combined = new Uint8Array(iv.length + cipherBuffer.byteLength);
            combined.set(iv, 0);
            combined.set(new Uint8Array(cipherBuffer), iv.length);
            return btoa(String.fromCharCode(...combined));
        }

        async function decryptText(cipherBase64) {
            if (!secretKey) await ensureSecretKey();
            try {
                const combined = Uint8Array.from(atob(cipherBase64), c => c.charCodeAt(0));
                const iv = combined.slice(0, 12);
                const data = combined.slice(12);
                const decryptedBuffer = await window.crypto.subtle.decrypt(
                    { name: "AES-GCM", iv },
                    secretKey,
                    data
                );
                return new TextDecoder().decode(decryptedBuffer);
            } catch {
                return "(Decryption error)";
            }
        }

        function passwordGen(length, inclUppercase, inclLowercase, inclNumbers, inclSpecsym) {
            let characters = "";
            if (inclUppercase) characters += "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            if (inclLowercase) characters += "abcdefghijklmnopqrstuvwxyz";
            if (inclNumbers) characters += "0123456789";
            if (inclSpecsym) characters += `!"#$%&'()*+,-./:;<=>?@[\\]^_\`{|}~`;

            let firstPart = "";
            if (inclUppercase) firstPart += "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            if (inclLowercase) firstPart += "abcdefghijklmnopqrstuvwxyz";

            let generatedPass = "";
            for (let i = 0; i < 3; i++) {
                if (firstPart.length === 0) break;
                generatedPass += firstPart.charAt(Math.floor(Math.random() * firstPart.length));
            }
            const remainingLength = length - generatedPass.length;
            for (let i = 0; i < remainingLength; i++) {
                generatedPass += characters.charAt(Math.floor(Math.random() * characters.length));
            }

            passwordHistory.push(generatedPass);
            if (passwordHistory.length > 5) passwordHistory.shift();

            return generatedPass;
        }

        async function passStrengthCheck(password) {
            const suggestions = [];
            if (password.length < 8) suggestions.push("Password should be at least 8 characters long");
            if (!/[A-Z]/.test(password)) suggestions.push("Password should consist of uppercase letters");
            if (!/[a-z]/.test(password)) suggestions.push("Password should consist of lowercase letters");
            if (!/\d/.test(password)) suggestions.push("Password should include numbers");
            if (!/[!"#$%&'()*+,-./:;<=>?@[\\\]^_\`{|}~]/.test(password)) suggestions.push("Password should include special symbols");
            try {
                const response = await fetch("https://lucidar.me/en/security/files/100000-most-common-passwords.json");
                if (response.ok) {
                    const commonPasswords = await response.json();
                    if (commonPasswords.includes(password.toLowerCase())) suggestions.push("Password is common");
                }
            } catch { }
            if (suggestions.length === 0) return ["Strong password", []];
            return ["Weak password", suggestions];
        }

        async function handleGeneratePassword() {
            const length = parseInt(document.getElementById("gen-length").value);
            if (isNaN(length) || length < 6) {
                alert("Password length must be at least 6!");
                return;
            }
            if (length > 30) {
                alert("Password length must not exceed 30!");
                return;
            }
            const inclUpper = document.getElementById("gen-uppercase").checked;
            const inclLower = document.getElementById("gen-lowercase").checked;
            const inclNum = document.getElementById("gen-numbers").checked;
            const inclSpec = document.getElementById("gen-specsym").checked;
            if (!inclUpper && !inclLower && !inclNum && !inclSpec) {
                alert("Please select at least one option to generate password");
                return;
            }
            const pwd = passwordGen(length, inclUpper, inclLower, inclNum, inclSpec);
            const out = document.getElementById("gen-output");

            const [strength, suggestions] = await passStrengthCheck(pwd);
            let strengthHTML = `<div>Password Strength: ${strength}</div>`;
            if (suggestions.length > 0) {
                strengthHTML += `<div style="color:#f55; margin-top:2px;">Suggestions:<br>- ${suggestions.join("<br>- ")}</div>`;
            }

            out.innerHTML = `
        <div>Generated Password:</div>
        <div style="color:white; font-weight:bold; font-size:1.2rem; margin:1px 0;">${pwd}</div>
        ${strengthHTML}
      `;

            if (suggestions.length === 0) {
                out.style.color = "#08b7a7"; // teal (for feedback clarity)
            } else {
                out.style.color = "#f55"; // red-ish
            }
        }

        async function handleCheckStrength() {
            const pwd = document.getElementById("check-input").value.trim();
            if (!pwd) {
                alert("Enter a password to evaluate");
                return;
            }
            const [strength, suggestions] = await passStrengthCheck(pwd);
            const out = document.getElementById("check-output");
            out.textContent = `Password Strength: ${strength}`;
            if (suggestions.length > 0) {
                out.textContent += `\nSuggestions:\n- ${suggestions.join("\n- ")}`;
                out.style.color = "#f55";
            } else {
                out.style.color = "#08b7a7";
            }
        }

        function displayHistory() {
            const container = document.getElementById("history-output");
            if (passwordHistory.length === 0) {
                container.textContent = "No passwords in history.";
                container.style.color = "white";
                return;
            }
            container.style.color = "white";
            const recentPasses = [...passwordHistory].reverse();
            container.textContent = recentPasses.map((p, i) => `${i + 1}. ${p}`).join("\n");
        }

        async function handleAddCredential() {
            const website = document.getElementById("manager-website").value.trim();
            const username = document.getElementById("manager-username").value.trim();
            const password = document.getElementById("manager-password").value;
            const out = document.getElementById("manager-output");
            if (!website || !username || !password) {
                alert("Please fill website, username, and password");
                return;
            }
            try {
                if (!secretKey) await ensureSecretKey();
                const encUser = await encryptText(username);
                const encPass = await encryptText(password);
                passManagerPasswords[website] = { username: encUser, password: encPass };
                localStorage.setItem(STORAGE_MANAGER_KEY, JSON.stringify(passManagerPasswords));
                out.style.color = "#08b7a7";
                out.textContent = `Credentials for "${website}" added successfully.`;
                document.getElementById("manager-website").value = "";
                document.getElementById("manager-username").value = "";
                document.getElementById("manager-password").value = "";
            }
            catch (error) {
                out.style.color = "#f55";
                //out.textContent = `Error adding credentials: ${error.message || error}`;
                out.textContent = `Password Manager is not supported on Mobile Devices and some browsers. Please wait for an update. Thank you!`;
            }
        }

        async function handleRetrieveCredential() {
            const out = document.getElementById("manager-output");
            const website = prompt("Enter the website name to retrieve credentials:");
            if (!website) {
                out.style.color = "#faa";
                out.textContent = "No website specified.";
                return;
            }
            try {
                if (!secretKey) await ensureSecretKey();
                if (website in passManagerPasswords) {
                    const creds = passManagerPasswords[website];
                    const username = await decryptText(creds.username);
                    const password = await decryptText(creds.password);
                    out.style.color = "white";
                    out.textContent = `Credentials:\nWebsite: ${website}\nUsername: ${username}\nPassword: ${password}`;
                } else {
                    out.style.color = "#faa";
                    out.textContent = `No credentials found for "${website}"`;
                }
            }
            catch (error) {
                out.style.color = "#f55";
                //out.textContent = `Error retrieving credentials: ${error.message || error}`;
                out.textContent = `Password Manager is not supported on Mobile Devices and some browsers. Please wait for an update. Thank you!`;
            }
        }

        function loadManagerPasswords() {
            const savedPasswords = localStorage.getItem(STORAGE_MANAGER_KEY);
            if (savedPasswords) {
                try {
                    passManagerPasswords = JSON.parse(savedPasswords);
                } catch {
                    passManagerPasswords = {};
                }
            } else {
                passManagerPasswords = {};
            }
        }

        async function init() {
            passwordHistory = [];
            loadManagerPasswords();
            await ensureSecretKey();
            displayHistory();
        }

        window.addEventListener("DOMContentLoaded", init);
    </script>
</body>

</html>
